@model Member

@{
    ViewBag.Title += " | Member Details";
}

@section head {
    <link rel="stylesheet" href="/css/admin.css" asp-append-version="true" />
    <link rel="stylesheet" href="/css/member.css" asp-append-version="true" />
}

@* Used admin-bg-page for consistent glassmorphism background *@
<div class="admin-container admin-bg-page">

    <div style="margin-bottom: 20px;">
        <a href="/Admin/Members" class="btn-back">← Back to Members</a>
    </div>

    <div class="details-grid">
        <div class="profile-card">
            <div class="profile-header-img">
                <img src="/images/@Model.PhotoURL" onerror="this.src='/images/default_photo.png'" alt="Profile Photo">
            </div>
            <h2 class="profile-name">@Model.Name</h2>
            <p class="profile-id">Member ID: <b>@Model.Id</b></p>

            <div class="profile-info-list">
                <div class="info-item">
                    <span class="label">📧 Email</span>
                    <span class="value">@(Model.Email ?? "-")</span>
                </div>
                <div class="info-item">
                    <span class="label">📞 Phone</span>
                    <span class="value">@(Model.Phone ?? "-")</span>
                </div>
                <div class="info-item">
                    <span class="label">🔒 Role</span>
                    <span class="value">Member</span>
                </div>
            </div>

            <div class="profile-actions" style="display: flex; gap: 10px;">

                <form method="post" action="/Admin/ToggleBlockMember/@Model.Id" style="flex: 1;">
                    @if (Model.IsBlocked)
                    {
                        <button type="submit" class="btn-tool" style="width:100%; background-color: #2ed573;">Unblock Account</button>
                    }
                    else
                    {
                        <button type="submit" class="btn-tool" style="width:100%; background-color: #f59e0b;">Block Account</button>
                    }
                </form>

                @* Delete Button Removed *@
            </div>
        </div>

        <div class="activity-section">
            <h3>📅 Recent Bookings</h3>

            @if (Model.Bookings != null && Model.Bookings.Any())
            {
                <table class="booking-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Date</th>
                            <th>Route</th>
                            <th>Status</th>
                            <th>Price</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var booking in Model.Bookings.OrderByDescending(b => b.BookingDate).Take(5))
                        {
                            <tr>
                                <td>#@booking.Id</td>
                                <td>@booking.BookingDate.ToString("dd MMM yyyy")</td>
                                <td>
                                    @if (booking.Trip?.Route != null)
                                    {
                                        <span>@booking.Trip.Route.Origin → @booking.Trip.Route.Destination</span>
                                    }
                                    else
                                    {
                                        <span>-</span>
                                    }
                                </td>
                                <td>
                                    <span class="status-badge status-@booking.Status.ToLower()">@booking.Status</span>
                                </td>
                                <td>RM @booking.TotalPrice.ToString("N2")</td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <div class="empty-state">
                    <p>No bookings found for this member.</p>
                </div>
            }
        </div>
    </div>
</div>