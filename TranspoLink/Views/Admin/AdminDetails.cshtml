@model Admin

@{
    ViewBag.Title += " | Admin Details";
    // Get the timeline data from Controller
    var timeline = ViewBag.Timeline as List<TimelineItemVM>;
}

@section head {
    <link rel="stylesheet" href="/css/admin.css" asp-append-version="true" />
    <link rel="stylesheet" href="/css/member.css" asp-append-version="true" />
    <script src="/js/admin.js" defer></script>
}

<div class="admin-container">

    <div style="margin-bottom: 20px;">
        <a href="/Admin/Admins" class="btn-back">← Back to Admins</a>
    </div>

    <div class="details-grid">

        <!-- LEFT: PROFILE CARD -->
        <div class="profile-card">
            <div class="profile-header-img">
                <img src="@(Model.PhotoURL != null && Model.PhotoURL.StartsWith("/images/") ? Model.PhotoURL : "/images/" + Model.PhotoURL)"
                     onerror="this.src='/images/beauty_admin.png'"
                     alt="Admin Photo">
            </div>

            <h2 class="profile-name">@Model.Name</h2>
            <p class="profile-id">Admin ID: <b>@Model.Id</b></p>

            <div class="profile-info-list">
                <div class="info-row">
                    <span class="info-label">📧 Email</span>
                    <span class="info-value">@(Model.Email ?? "-")</span>
                </div>
                <div class="info-row">
                    <span class="info-label">📞 Phone</span>
                    <span class="info-value">@(Model.Phone ?? "-")</span>
                </div>
                <div class="info-row">
                    <span class="info-label">🔒 Role</span>
                    <span class="info-value">
                        @(Model.Id == "A001" ? "System Administrator" : "Administrator")
                    </span>
                </div>
                <div class="info-row">
                    <span class="info-label">📶 Status</span>
                    <span class="info-value">
                        @if (Model.IsBlocked)
                        {
                            <span class="status-blocked">Blocked</span>
                        }
                        else
                        {
                            <span class="status-active">Active</span>
                        }
                    </span>
                </div>
            </div>

            <!-- ACTION BUTTONS -->
            <div class="profile-btn-group">
                @if (Model.Id != "A001")
                {
                    <form method="post" action="/Admin/ToggleBlockAdmin/@Model.Id" style="flex:1; display:flex;">
                        @if (Model.IsBlocked)
                        {
                            <button type="submit" class="btn-unblock">🔓 Unblock Account</button>
                        }
                        else
                        {
                            <button type="submit" class="btn-block">Block Account</button>
                        }
                    </form>

                    <button type="button" class="btn-delete-action"
                            onclick="openConfirmModal('/Admin/DeleteAdmin/@Model.Id', '@Model.Name')">
                        Delete Account
                    </button>
                }
                else
                {
                    <button disabled class="btn-view" style="flex:1; opacity:0.5; cursor:not-allowed;">Protected</button>
                }
            </div>

        </div> <div class="timeline-section">
            <div class="timeline-header">
                <h3>🧭 Action Trajectory <span style="font-size:12px; color:#999; margin-left:10px;">(Recent Activity)</span></h3>
            </div>

            <ul class="timeline-list">
                @if (timeline != null && timeline.Any())
                {
                    foreach (var item in timeline)
                    {
                        <li class="timeline-item">
                            <div class="timeline-marker @item.CssClass">@item.Icon</div>
                            <div class="timeline-content">
                                <div class="timeline-title">@item.Title</div>
                                <div class="timeline-time">@item.Time</div>
                            </div>
                        </li>
                    }
                }
                else
                {
                    <p style="text-align:center; color:#999; padding:20px;">No activity recorded.</p>
                }
            </ul>
        </div>

    </div>
</div> 
<!-- Reusing the Modal from Admins page (Ensure admin.js includes openConfirmModal logic) -->
<div id="confirmModal" class="confirm-overlay">
    <div class="confirm-box">
        <span class="confirm-icon">⚠️</span>
        <h3 class="confirm-title">Delete Admin?</h3>
        <p class="confirm-text">
            Are you sure you want to remove <b id="deleteNameDisplay" style="color:#ff4757;"></b>?<br>
            This action cannot be undone.
        </p>

        <div class="confirm-actions">
            <button onclick="closeConfirmModal()" class="btn-confirm-cancel">Cancel</button>

            <form method="post" id="deleteConfirmForm">
                <button type="submit" class="btn-confirm-delete">Yes, Delete</button>
            </form>
        </div>
    </div>
</div>