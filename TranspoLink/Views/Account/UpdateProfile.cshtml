@model UpdateProfileVM

@{
    ViewBag.Title += " | My Profile";
}

@section head {
    <!-- Using your existing CSS files -->
    <link rel="stylesheet" href="/css/member.css" asp-append-version="true"/>
    <link rel="stylesheet" href="/css/photo-tools.css" asp-append-version="true"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <script src="/js/photo-tools.js" defer></script>
    <script src="/js/user.js" defer></script>
}

<div class="profile-container">

    <!-- Wrapper for the 2-Column Layout -->
    <div class="profile-layout-wrapper">

        <!-- === LEFT COLUMN (Header + Profile Form) === -->
        <div class="profile-left-col">
            <form method="post" enctype="multipart/form-data" id="profileForm">
                <div asp-validation-summary="ModelOnly" class="validation-summary-errors"></div>

                <!-- 1. HEADER SECTION -->
                <div class="user-header-banner">
                    <div class="upload-trigger">
                        <!-- Photo upload is disabled initially until Edit Mode is active -->
                        <label class="upload disabled-upload" id="photoLabel" title="Edit Profile to change photo">
                            <input asp-for="Photo" accept="image/jpeg,image/png" hidden disabled>
                            <!-- Display Profile Picture -->
                            <img src="@(string.IsNullOrEmpty(Model.PhotoURL) || Model.PhotoURL == "default_photo.png" ? "/images/default_photo.png" : (Model.PhotoURL.StartsWith("/images/") ? Model.PhotoURL : "/photos/" + Model.PhotoURL))"
                                 class="user-avatar-large"
                                 onerror="this.src='/images/default_photo.png'">
                        </label>

                        <div class="user-info-text">
                            <h2>
                                @Model.Name
                                <span class="role-badge">@Model.Role</span>
                            </h2>
                            <div class="user-id-text">
                                @(Model.Email ?? Model.Phone)
                            </div>
                        </div>
                    </div>

                    <div style="margin-left: auto;">
                        <button type="button" class="btn-edit-photo" id="btnEditProfile">Edit User Profile</button>
                    </div>
                </div>

                <!-- 2. PROFILE INFORMATION -->
                <div class="settings-section">

                    <div class="field-row">
                        <div class="field-info" style="flex: 1;">
                            <label asp-for="Name">Display Name</label>
                            <!-- Added readonly attribute -->
                            <input asp-for="Name" class="field-input" placeholder="Your Name" readonly>
                            <span asp-validation-for="Name" style="color:red; font-size:12px;"></span>
                        </div>
                    </div>

                    <div class="field-row">
                        <div class="field-info" style="flex: 1;">
                            <label asp-for="Email">Email</label>
                            <!-- Added readonly attribute -->
                            <input asp-for="Email" class="field-input" placeholder="Your Email" readonly>
                            <span asp-validation-for="Email" style="color:red; font-size:12px;"></span>
                        </div>
                    </div>

                    <div class="field-row">
                        <div class="field-info" style="flex: 1;">
                            <label asp-for="Phone">Phone Number</label>
                            <!-- Added readonly attribute -->
                            <input asp-for="Phone" class="field-input" placeholder="Your Phone Number" readonly>
                            <span asp-validation-for="Phone" style="color:red; font-size:12px;"></span>
                        </div>
                    </div>

                </div>
            </form>
        </div>

        <!-- === RIGHT COLUMN (Password + Removal) === -->
        <div class="profile-right-col">

            <!-- 3. PASSWORD & AUTHENTICATION -->
            <div class="settings-section">
                <h3 class="section-title">Password and Authentication</h3>

                <div class="field-row" style="border:none; padding-bottom:0;">
                    <a href="/Account/UpdatePassword" class="btn-change-pass" style="width:100%; text-align:center;">Change Password</a>
                </div>
            </div>

            <!-- 4. ACCOUNT REMOVAL -->
            <div class="settings-section" style="border-color: #faa6a8;">
                <h3 class="section-title" style="color:#ed4245;">Account Removal</h3>
                <p style="font-size:13px; color:#666; margin-bottom:15px;">
                    Disabling your account means you can recover it at any time.
                </p>

                <div style="display:flex; flex-direction:column; gap:10px;">
                    <button class="btn-danger-solid" onclick="alert('This feature is currently disabled by Admin.')" style="width:100%;">Delete Account</button>
                    <button class="btn-danger-outline" onclick="alert('This feature is currently disabled by Admin.')" style="width:100%;">Disable Account</button>
                </div>
            </div>

        </div>

    </div>

    <!-- FLOATING SAVE BUTTON -->
    <div class="btn-save-float" id="saveBar" style="display:none;">
        <span>Careful - you have unsaved changes!</span>
        <div style="margin-left:auto; display:flex; gap:10px;">
            <button type="button" class="btn-danger-outline" style="border:none; color:#ccc;" onclick="location.reload()">Reset</button>
            <button type="button" class="btn-save-confirm" onclick="$('#profileForm').submit()">Save Changes</button>
        </div>
    </div>

</div>