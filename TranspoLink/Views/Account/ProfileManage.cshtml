@model UpdateProfileVM

@{
    ViewBag.Title += " | My Profile";
}

@section head {
    <link rel="stylesheet" href="/css/member.css" asp-append-version="true" />
    <link rel="stylesheet" href="/css/photo-tools.css" asp-append-version="true" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <script src="/js/photo-tools.js" defer></script>
    <script src="/js/user.js" defer></script>
}

<div class="profile-container">

    <div class="profile-layout-wrapper">

        <div class="profile-left-col">
            <form method="post" enctype="multipart/form-data" id="profileForm">
                <div asp-validation-summary="ModelOnly" class="validation-summary-errors"></div>

                <input asp-for="Photo" type="file" accept="image/jpeg,image/png" hidden disabled>

                <div class="user-header-banner">

                    <div class="upload-trigger">

                        <div class="profile-pic-wrapper">
                            <div class="upload disabled-upload" id="photoContainer" title="Click to Preview (or Edit)">
                                @{
                                    var imgSrc = string.IsNullOrEmpty(Model.PhotoURL) || Model.PhotoURL == "default_photo.png"
                                    ? "/images/default_photo.png"
                                    : (Model.PhotoURL.StartsWith("/images/") ? Model.PhotoURL : "/images/" + Model.PhotoURL);
                                }
                                <img src="@imgSrc"
                                     class="user-avatar-large"
                                     id="profileImagePreview"
                                     onerror="this.src='/images/default_photo.png'">
                            </div>

                            @if (Model.PhotoURL != "default_photo.png" && !string.IsNullOrEmpty(Model.PhotoURL))
                            {
                                <a href="@imgSrc" download="ProfilePhoto.jpg" class="btn-download-icon" title="Download Photo">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="7 10 12 15 17 10"></polyline>
                                        <line x1="12" y1="15" x2="12" y2="3"></line>
                                    </svg>
                                </a>
                            }
                        </div>

                        <div class="user-info-text">
                            <h2>@Model.Name</h2>
                            <div class="user-id-text">
                                @(Model.Email ?? Model.Phone)
                            </div>
                        </div>
                    </div>

                    <div style="margin-left: auto;" class="header-actions">
                        <button type="button" class="btn-edit-photo" id="btnEditProfile">Edit User Profile</button>

                        <div id="editActions" style="display:none; gap: 10px; align-items:center;">
                            <button type="button" class="btn-cancel-edit" onclick="location.reload()">Cancel</button>
                            <button type="submit" class="btn-save-changes">Save Changes</button>
                        </div>
                    </div>
                </div>

                <div class="settings-section">

                    <div class="field-row">
                        <div class="field-info" style="flex: 1;">
                            <label asp-for="Name">Display Name</label>
                            <input asp-for="Name" class="field-input" placeholder="Your Name" readonly>
                            <span asp-validation-for="Name" style="color:red; font-size:12px;"></span>
                        </div>
                    </div>

                    <div class="field-row">
                        <div class="field-info" style="flex: 1;">
                            <label asp-for="Email">Email</label>
                            <input asp-for="Email" class="field-input" placeholder="Your Email" readonly>
                            <span asp-validation-for="Email" style="color:red; font-size:12px;"></span>
                        </div>
                    </div>

                    <div class="field-row">
                        <div class="field-info" style="flex: 1;">
                            <label asp-for="Phone">Phone Number</label>
                            <input asp-for="Phone" class="field-input" placeholder="Your Phone Number" readonly>
                            <span asp-validation-for="Phone" style="color:red; font-size:12px;"></span>
                        </div>
                    </div>

                </div>
            </form>
        </div>

        <div class="profile-right-col">

            <div class="settings-section">
                <h3 class="section-title">Password and Authentication</h3>

                <div class="field-row" style="border:none; padding-bottom:0;">
                    <a href="/Account/UpdatePassword" class="btn-change-pass" style="width:100%; text-align:center;">Change Password</a>
                </div>
            </div>

            <div class="settings-section" style="border-color: #faa6a8;">
                <h3 class="section-title" style="color:#ed4245;">Account Removal</h3>
                <p style="font-size:13px; color:#666; margin-bottom:15px;">
                    Disabling your account means you can recover it at any time.
                </p>

                <div style="display:flex; flex-direction:column; gap:10px;">
                    <button class="btn-danger-solid" onclick="alert('This feature is currently disabled by Admin.')" style="width:100%;">Delete Account</button>
                    <button class="btn-danger-outline" onclick="alert('This feature is currently disabled by Admin.')" style="width:100%;">Disable Account</button>
                </div>
            </div>

        </div>

    </div>
</div>

<div id="imagePreviewModal" class="modal-overlay" style="display:none;" onclick="closePreview()">
    <div class="preview-box" onclick="event.stopPropagation()">
        <span class="close-preview" onclick="closePreview()">×</span>
        <img id="previewImgTarget" src="" alt="Profile Preview">
    </div>
</div>