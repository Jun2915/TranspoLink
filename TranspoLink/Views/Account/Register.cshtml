@model RegisterVM
@{
    ViewBag.Title += " | Register";
}

@section head {
    <link rel="stylesheet" href="/css/login.css" asp-append-version="true" />
    <link rel="stylesheet" href="/css/policy.css" asp-append-version="true" />
    <script src="/js/regNlog.js" asp-append-version="true" defer></script>
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
}

@if (ViewBag.Success == true)
{
    <div class="success-overlay">
        <div class="success-card">
            <div class="success-icon">✓</div>
            <h2>Congratulations!</h2>
            <p>Account created for <b>@ViewBag.RegisteredName</b></p>
            <br>
            <p style="font-size:14px; color:#999;">Redirecting in <span id="countdown" class="countdown-text">5</span> seconds...</p>
            <a href="/Account/Login" class="auth-submit-btn" style="display:inline-block; text-decoration:none; width:auto; padding:10px 30px;">Login Now</a>
        </div>
    </div>
    <script>
        let seconds = 5;
        setInterval(function() {
            seconds--;
            document.getElementById('countdown').innerText = seconds;
            if (seconds <= 0) {
                window.location.href = '/Account/Login';
            }
        }, 1000);
    </script>
}

<div class="auth-container">
    <div class="auth-card landscape-mode">
        <div class="auth-tabs">
            <a href="/Account/Login" class="auth-tab">Log in</a>
            <a href="/Account/Register" class="auth-tab active">Sign up</a>
        </div>

        <form method="post" asp-action="Register" asp-controller="Account" enctype="multipart/form-data" class="auth-form">
            <div asp-validation-summary="ModelOnly" class="validation-summary-errors"></div>

            <div class="register-layout">

                <div class="register-left">
                    <div class="auth-photo-upload" style="text-align:center; width: 70%;">
                        <label class="upload auth-upload">
                            <input asp-for="Photo" accept="image/jpeg,image/png" hidden>
                            <img src="/images/add_photo.png" alt="Upload Photo" style="width:150px; height:150px; object-fit:cover; border-radius:50%; border:2px dashed #ccc;">
                            <span class="auth-upload-text" style="display:block; margin-top:10px; color:#666;">Tap to upload photo</span>
                        </label>

                        <button type="button" class="btn-open-camera" onclick="startWebcam()">
                            📸 Use Camera
                        </button>

                        <span asp-validation-for="Photo" class="field-validation-error"></span>
                    </div>
                </div>

                <div class="register-right">

                    <div class="form-grid">

                        <div>
                            <div class="auth-input-group">
                                <span class="auth-input-icon">
                                    <svg class="icon-email" width="20" height="20" viewBox="0 0 24 24" fill="#666">
                                        <path d="M20,8L12,13L4,8V6L12,11L20,6M20,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V6C22,4.89 21.1,4 20,4Z" />
                                    </svg>
                                    <svg class="icon-phone" style="display:none;" width="20" height="20" viewBox="0 0 24 24" fill="#666">
                                        <path d="M6.62,10.79C8.06,13.62 10.38,15.94 13.21,17.38L15.41,15.18C15.69,14.9 16.08,14.82 16.43,14.93C17.55,15.3 18.75,15.5 20,15.5A1,1 0 0,1 21,16.5V20A1,1 0 0,1 20,21A17,17 0 0,1 3,4A1,1 0 0,1 4,3H7.5A1,1 0 0,1 8.5,4C8.5,5.25 8.7,6.45 9.07,7.57C9.18,7.92 9.1,8.31 8.82,8.59L6.62,10.79Z" />
                                    </svg>
                                </span>
                                <input asp-for="Input" type="text" placeholder="Email / Phone Number">
                            </div>
                            <span asp-validation-for="Input" class="field-validation-error"></span>

                            <div class="auth-input-group" style="margin-top: 20px;">
                                <span class="auth-input-icon">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="#666"><path d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z" /></svg>
                                </span>
                                <input asp-for="Name" type="text" placeholder="Full Name">
                            </div>
                            <span asp-validation-for="Name" class="field-validation-error"></span>
                        </div>

                        <div>
                            <div class="auth-input-group">
                                <span class="auth-input-icon">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="#666"><path d="M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10C4,8.89 4.9,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z" /></svg>
                                </span>

                                @* ID needed for JS to target this specific field *@
                                <input asp-for="Password" type="password" placeholder="Password" id="regPassword">

                                <button type="button" class="auth-toggle-password">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="#999"><path d="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z" /></svg>
                                </button>

                                @* --- PASSWORD REQUIREMENT POPUP --- *@
                                <div id="passwordPopup" class="password-requirements-popup">
                                    <p>Password must contain:</p>
                                    <div class="req-item invalid" id="req-letter"><span class="req-icon">✖</span> At least one letter</div>
                                    <div class="req-item invalid" id="req-capital"><span class="req-icon">✖</span> At least one capital letter</div>
                                    <div class="req-item invalid" id="req-number"><span class="req-icon">✖</span> At least one number</div>
                                    <div class="req-item invalid" id="req-symbol"><span class="req-icon">✖</span> At least one symbol</div>
                                    <div class="req-item invalid" id="req-length"><span class="req-icon">✖</span> Be at least 8 characters</div>
                                </div>
                                @* ---------------------------------- *@

                            </div>
                            <span asp-validation-for="Password" class="field-validation-error"></span>

                            <div class="auth-input-group" style="margin-top: 20px;">
                                <span class="auth-input-icon">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="#666"><path d="M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10C4,8.89 4.9,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z" /></svg>
                                </span>
                                <input asp-for="Confirm" type="password" placeholder="Confirm Password">
                                <button type="button" class="auth-toggle-password">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="#999"><path d="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z" /></svg>
                                </button>
                            </div>
                            <span asp-validation-for="Confirm" class="field-validation-error"></span>
                        </div>
                    </div>

                    @* --- MANDATORY CHECKBOX WITHOUT TARGET BLANK --- *@
                    <div style="margin-top: 10px; margin-bottom: 5px;">
                        <label class="auth-checkbox">
                            <input asp-for="TermsAgreed" type="checkbox" id="termsCheck">
                            <span class="legal-text-row" style="margin-left: 0;">
                                I agree to the
                                <a href="/Home/TermsAndConditions" class="legal-link">Terms</a>
                                &
                                <a href="/Home/PrivacyPolicy" class="legal-link">Privacy Policy</a>.
                            </span>
                        </label>
                        <span asp-validation-for="TermsAgreed" class="field-validation-error"></span>
                    </div>

                    <div class="g-recaptcha"
                         data-sitekey="6Ld3iBosAAAAAHOjrhAT_ufqDtdaUHcKIYH94G4-"
                         style="margin-top: 20px; display: flex; justify-content: center;">
                    </div>

                    <button type="submit" class="auth-submit-btn" id="regBtn" disabled>Sign Up</button>

                    <div class="auth-divider"><span>or sign up with</span></div>
                    <div class="auth-social-buttons">
                        <a href="/Account/GoogleLogin" class="auth-social-btn google" style="text-decoration:none;">
                            <svg style="width:20px; height:20px; margin-right:8px;" viewBox="0 0 24 24">
                                <path fill="currentColor" d="M21.35,11.1H12.18V13.83H18.69C18.36,17.64 15.19,19.27 12.19,19.27C8.36,19.27 5,16.25 5,12.61C5,8.85 8.38,5.78 12.23,5.78C14.61,5.78 16.28,6.59 17.15,7.45L19.57,5.03C17.65,3.23 15.1,2.37 12.23,2.37C6.61,2.37 2,6.97 2,12.66C2,18.35 6.61,22.95 12.23,22.95C17.89,22.95 21.66,19.06 21.66,13.37C21.66,12.52 21.57,11.83 21.35,11.1Z" />
                            </svg>
                            Sign up with Google
                        </a>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>