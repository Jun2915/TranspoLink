@model TranspoLink.Models.BookingVM
@{
    ViewBag.Title = "Payment";
}
@section head {
    <link rel="stylesheet" href="/css/RNT.css" asp-append-version="true" />
    <link rel="stylesheet" href="/css/RAP.css" asp-append-version="true" />
    <link rel="stylesheet" href="/css/payment.css" asp-append-version="true" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
}

@* 步骤指示器：现在 3. Payment 是激活状态 *@
<div class="stepper-header-container">
    <div class="stepper-header">
        <ol>
            <li class="active-step">
                @* 链接回第 1 步：选座 *@
                <a asp-controller="Booking"
                   asp-action="Book"
                   asp-route-id="@Model.TripId"
                   style="text-decoration: none; color: inherit;">
                    1. Select seats
                </a>
            </li>
            <li class="active-step">
                @* 🛠️ 新增：链接回第 2 步：个人信息详情 *@
                <a asp-controller="Booking"
                   asp-action="ReviewAndPay"
                   style="text-decoration: none; color: inherit;">
                    2. Passenger Information
                </a>
            </li>
            <li class="current-step">3. Payment</li>
        </ol>
    </div>
</div>

<div class="booking-container rap-main-content">
    <div class="booking-left rap-left-column">
        <h3 class="payment-title">Select Payment Method</h3>

        <div class="payment-selection-card">
            <div class="method-group active">
                <label class="radio-label">
                    <input type="radio" name="payMethod" value="Card" checked>
                    <span class="custom-radio"></span>
                    Credit/Debit card
                </label>

                <div id="card-fields" class="method-details">
                    <div class="input-wrapper">
                        <input type="text" id="cardNumber" class="modern-input"
                               placeholder="xxxx xxxx xxxx xxxx" maxlength="19">
                    </div>

                    <div class="input-row">
                        <div class="input-wrapper half">
                            <input type="text" id="expiry" class="modern-input"
                                   placeholder="MM/YY" maxlength="5">
                        </div>
                        <div class="input-wrapper half">
                            <input type="password" id="cvv" class="modern-input"
                                   placeholder="CVV" maxlength="3">
                        </div>
                    </div>
                </div>
            </div>

            <hr class="divider" />

            <h4 class="payment-title">Third-Party Payment Method</h4>
            <div class="pay-method-box" id="tng-section">
                <div class="pay-header">
                    <label>
                        <input type="radio" name="payMethod" value="TNG">
                        <span>TNG eWallet</span> 
                    </label>
                </div>

                <div id="tng-fields" style="display:none; text-align:center; padding:20px;">
                    <div id="qrcode-container" style="display: flex; justify-content: center; margin: 10px auto;">
                        @* 二维码将由 JS 渲染到这里 *@
                    </div>
                    <p style="margin-top: 15px; font-weight: bold; color: #6610f2;">Please scan to complete payment</p> 
                </div>
            </div>
        </div>
    </div>

    <div class="booking-right rap-right-column">
        <div class="rnt-card price-summary-card">
            <h4>Fare Breakdown</h4>
            <div class="info-row">
                <span>Total Amount</span>
                <span class="total-price">RM @Model.FinalTotal.ToString("N2")</span> 
            </div>
            <button type="button" id="finalPayBtn" class="confirm-btn">
                Confirm Payment
            </button> 
        </div>
    </div>
</div>

@section Scripts {
    <script src="/js/payment.js"></script>
}